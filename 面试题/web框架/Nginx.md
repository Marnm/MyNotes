---
title: Nginx
tags: []
---

**Nginx平滑升级的原理**  
- 在不停掉原有进程的情况下，启动新进程；
- 原进程负责处理仍绕没有处理完的请求，但不再接受处理请求；
- 新进程接收信新请求；
- 原进程处理完所有请求，关闭所有连接，停止。

**Nginx主进程处理支持的信号**  
- `TERM`, `INT`：立刻退出
- `QUIT`：等待工作进程结束再退出
- `KILL`：强制终止进程
- `HUP`：重新加载配置文件，使用新的的配置启动工作进程，并逐步关闭旧进程
- `USR1`：重新打开日志文件
- `USR2`：启动新的主进程，实现热升级
- `WINCH`：逐步关闭工作进程，工作进程支持的信号

**Nginx虚拟主机配置的几种方法**  
- 基于域名的虚拟主机：`server_name domain`
- 基于端口的虚拟主机：`listen port`
- 基于IP地址的虚拟主机：`listen IP_Addr:[port]`

**Nginx的四层负载均衡与七层负载均衡**  
- （1）四层负载均衡：  
四层负载均衡工作在 OSI 七层模型的第四层（传输层），指的是负载均衡设备通过报文中的目标IP地址、端口和负载均衡算法，选择到达的目标内部服务器，四层负载均衡对数据包只起一个数据转发的作用，无法修改或判断所请求资源的具体类型，也不会干预客户端与服务端之间应用层的通信（如三次握手等）。但在某些部署情况下，为保证服务器回包可以正确返回给负载均衡设备，在转发报文的同时可能会对报文原来的源地址进行修改。  
四层负载均衡单纯的提供了终端到终端的可靠连接，并将请求转发至后端，连接至始至终都是同一个。LVS就是很典型的四层负载均衡。  
- （2）七层负载均衡：  
七层负载均衡工作在 OSI 模型的第七层（应用层），指的是负载均衡设备通过请求报文中的应用层信息(如URL、HTTP头部、资源类型等信息)和负载均衡算法，选择到达的目标内部服务器。七层负载均衡的功能更加丰富灵活，另外七层负载均衡两端（面向客户端和服务器端）的连接都是独立的，在一定程度上也提升了后端系统的安全性，因为像网络常见的DoS攻击，在七层负载均衡的环境下通常在负载均衡设备上就截止了，不会影响到后端服务器的正常运行。比如常见 Nginx 就是运行在七层的负载均衡软件。
